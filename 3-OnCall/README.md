# Домашнее задание №3 "OnCall"

## 1 задание

Для закрепления полученных навыков в рамках данной практики вы развёрнете приложение-пример в кластере Kubernetes.

Изучите приложенные манифесты и выполните деплой приложения согласно инструкции в README.

В качестве решения приложите видеозапись демонстрации экрана. На видео должно быть продемонстрировано выполнение всех пунктов. Обязательно продемонстрируйте доступность OnCall в браузере в конце видео.

**Предварительная подготовка**

Перед развёртыванием OnCall удалите все нагрузки, запущенные во время выполнения предыдущих заданий.
```
kubectl delete --all deployments -n st-user

kubectl delete --all statefulsets -n st-user

kubectl delete --all daemonsets -n st-user
```
**Развёртывание СУБД MySQL**

Для корректной работы OnCall требуется база данных. В качестве примера мы будем использовать MySQL.

**Разверните MySQL и связанные ресурсы:**
```
export KUBE_NS=st-<ваш пользователь>

kubectl apply -f manifests/mysql/secret.yaml -n $KUBE_NS

kubectl apply -f manifests/mysql/statefulset.yaml -n $KUBE_NS
 
kubectl apply -f manifests/mysql/service.yaml -n $KUBE_NS
```

**Проверьте, что под MySQL запущен:**
> kubectl get pod -n $KUBE_NS

**Развёртывание приложения OnCall**

Перейдём к развёртыванию OnCall.

В манифестах используются шаблоны для указания вашего неймспейса к конфигурациях и адресах для публикации.

Создайте объект конфигурации OnCall

> KUBE_NS=$KUBE_NS envsubst < manifests/oncall/config.yaml | kubectl apply -f - -n $KUBE_NS

Запустите под OnCall

> KUBE_NS=$KUBE_NS envsubst < manifests/oncall/deployment.yaml | kubectl apply -f - -n $KUBE_NS

Создайте сетевые ресурсы
```
KUBE_NS=$KUBE_NS envsubst < manifests/oncall/service.yaml | kubectl apply -f - -n $KUBE_NS

KUBE_NS=$KUBE_NS envsubst < manifests/oncall/ingress.yaml | kubectl apply -f - -n $KUBE_NS
```
Выполните проверку того, что все необходимые ресурсы созданы.

**Демонстрация**
- После развёртывания OnCall перейдите в браузере по адресу: http://oncall.st-<ваш пользователь>.ingress.sre-ab.ru
- Авторизуйтесь, используя логин "root" и пароль "1234"
- Ознакомитесь с UI, создайте несколько пользователей, команду и заполните расписание дежурств на несколько дней

## 2 задание

Изучите манифесты, приложенные к материалам семинара. Какие проблемы (нарушение best practices, потенциальные уязвимости и т.д.) Вы заметили?

Опишите минимум две обнаруженные проблемы и способы их исправления.

## 3 задание

Обновите версию MySQL, указав образ контейнера `mysql:8.4.0`.

Перейдите в UI OnCall и проверьте наличие созданных ранее команд, пользователей и других сущностей.

Ознакомьтесь с документацией Kubernetes по хранилищам. Изучите манифесты, использованные для развёртывания MySQL и опишите, что произошло при обновлении версии MySQL.