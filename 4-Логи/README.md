# Домашнее задание №4 "Логи"

## 2 задание

**Практика: Отправка логов Oncall в Sage**

**Цель:**

Сделать так, чтобы логи вашего приложения Oncall начали поступать в систему логирования **Sage Observability**.

Вы должны организовать сбор и преобразование логов, чтобы Sage их корректно принимал и отображал.

**Что уже настроено**

В кластере развернут Vector DaemonSet, который:
* Читает логи со всех подов, у которых указана аннотация sage/group
* Отбрасывает логи, которые не соответствуют JSON-формату
* Отправляет логи в Sage

**Ваша задача**
1) Добавить аннотацию к вашему pod с Oncall:
> sage/group: "ab3_ivanov"
> 
> Группа Sage совпадает с вашим логином от Sage. Например: sage/group: "ab3_ivanov"
2) Настроить сбор логов Oncall так, чтобы DaemonSet смог их прочитать:
* Приложение (pod) должно писать логи в stdout, либо в файл, доступный агенту.
* Формат логов должен быть **JSON**.
* Должны выполняться требования системы Sage к структуре логов.
3) Убедиться, что логи доходят до Sage:
* Перейдите на https://sage.sre-ab.ru
* Найдите логи, отфильтровав по вашей группе:
> group = "<группа_sage>"

Sage автоматически отправляет heartbeat логи во все созданные группы. Это корректно поведение. Отфильтровать их можно так: group="<группа_sage>" system!="heartbeat"

**Требования Sage к логам**

Перед отправкой убедитесь, что ваши логи соответствуют требованиям системы:
* Все логи должны быть в формате JSON
* Присутствуют все обязательные поля. Подробнее — в документации Sage.

Если лог не соответствует формату (но отправлен в формате JSON), он попадает в специальный индекс dead-letters. В нём можно посмотреть причину отклонения и исправить ошибку. Подробнее — в разделе Dead Letters документации Sage.

**Подсказка (но не ограничение)**

Вы можете выбрать любой способ обработки логов — лишь бы они дошли до Sage.

Например:
* добавить sidecar-контейнер с Vector, который читает stout Oncall и приводит строки к JSON
* использовать свой Python/Go/Java/Pascal/Кумир/Fortran скрипт в виде sidecar-а, который читает файл с логами и пишет в stdout в нужном формате.
* или изменить приложение Oncall так, чтобы оно само писало структурированные JSON-логи.

Главное — результат: ваши логи появляются в Sage с нужными полями.

**Ответ**

В качестве ответа приложите архив с видеозаписью демонстрации поиска логов OnCall в Sage и использованные манифесты.

## 3 задание

Опишите весь путь логов от их появления в приложении Oncall до попадания в систему Sage.
Укажите, какие слабые места есть у такой схемы.
Предложите альтернативы, которые сделали бы систему более надёжной или проще в эксплуатации.