# Домашнее задание №5 "Метрики"

## 1 задание

В рамках данного задания Вы продолжите работу над повышением наблюдаемости приложения OnCall. Как и в большинстве сервисов, в OnCall реализован экспорт метрик в формате Prometheus. Необходимо настроить доставку этих метрик в Sage для дальнейшего использования.

Для включения экспорта метрик потребуется:
* сконфигурировать приложение для экспорта метрик в формате Prometheus (hint: заменить metrics: dummy на metrics: prometheus в конфигурации)
* указать целевой порт, на котором будет запущен экспорт метрик (hint: определить параметр prometheus.oncall-notifier.server_port в конфигурации, при возникновении сложностей изучить исходный код)
* обновить версию sre-ab-oncall до 0.3 (образ с установленной зависимостью prometheus_client)

В кластере уже развёрнут компонент vmagent, обеспечивающий сбор метрик. Для настройки таргета для сбора метрик укажите аннотации в объекте Service:
* prometheus.io/scrape — true, если нужно включить этот сервис в мониторинг
* prometheus.io/port — номер порта целевого pod-а, с которого доступны метрики, является обязательным. Этот же порт должен быть указан как targetPort сервиса, так как vmagent будет скрейпить метрики с каждого эндпоинта
* prometheus.io/path — URI, по которому доступны метрики (/metrics по умолчанию)
Мы самостоятельно добавим некоторые системные лейблы к собираемым метрикам:
* group — ваша группа sage
* system — имя сервиса
* env, dc, k8scluster

В качестве ответа приложите архив с видеозаписью демонстрации поиска метрик OnCall в Sage и использованные манифесты.

Пример запроса для поиска метрик в Sage:
> pql {group=<ваша группа в sage>, service="oncall"}

## 2 задание

Для реализации наблюдаемости требуется мониторинг всех компонентов системы. В рамках данного задания Вам необходимо также настроить сбор метрик с используемой СУБД MySQL. В качестве ответа приложите архив с демонстрацией поиска метрик MySQL в Sage, кратким описанием решения и всеми использованными для настройки манифестами.
